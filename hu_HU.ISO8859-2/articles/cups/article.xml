<?xml version="1.0" encoding="iso-8859-2"?>
<!DOCTYPE article PUBLIC "-//FreeBSD//DTD DocBook XML V5.0-Based Extension//EN"
	"http://www.FreeBSD.org/XML/share/xml/freebsd50.dtd">
<!-- The FreeBSD Hungarian Documentation Project
     Translated by: PALI, Gabor <pgj@FreeBSD.org>
     %SOURCE%   en_US.ISO8859-1/articles/cups/article.xml
     %SRCID%    1.5
-->
<article xmlns="http://docbook.org/ns/docbook" xmlns:xlink="http://www.w3.org/1999/xlink" version="5.0" xml:lang="hu">
  <info><title>A CUPS használata &os; rendszereken</title>
    

    <authorgroup>
      <author><personname><firstname>Chess</firstname><surname>Griffin</surname></personname><affiliation>
	  <address><email>chess@chessgriffin.com</email></address>
	</affiliation></author>
    </authorgroup>

    <legalnotice xml:id="trademarks" role="trademarks">
      &tm-attrib.freebsd;
      &tm-attrib.general;
    </legalnotice>

    <pubdate>$FreeBSD$</pubdate>

    <releaseinfo>$FreeBSD$</releaseinfo>

    <abstract>
      <para>Ez a cikk a CUPS beállítását
	és használatát mutatja be a &os;
	operációs rendszeren.</para>

      <para><emphasis>Fordította: Páli Gábor,
	utolsó ellenõrzés:
	2010.11.28.</emphasis></para>
    </abstract>
  </info>

  <sect1 xml:id="printing-cups">
    <title>A Common Unix Printing System (CUPS) rövid
      bemutatása</title>

    <indexterm><primary>nyomtatás</primary></indexterm>
    <indexterm><primary>CUPS</primary></indexterm>

    <para>A <application>CUPS</application>, avagy <emphasis>Common UNIX
	Printing System</emphasis> (Egységes UNIX Nyomtatási
      Rendszer) a &unix; alapú operációs
      rendszerekhez fejlesztett hordozható nyomtatási
      réteg.  Az Easy Software Products egy szabványos
      nyomtatási technológiaként alkotta meg a
      &unix; gyártók és felhasználók
      számára.</para>

    <para>A <application>CUPS</application> az ún.
      <emphasis>Internet Printing Protocol</emphasis>
      (<acronym>IPP</acronym>, Internetes Nyomtatási Protokoll)
      megoldásaira támaszkodóan kezeli a
      nyomtatási feladatokat és sorokat.  Emellett
      még a <emphasis>Line Printer Daemon</emphasis>
      (<acronym>LPD</acronym>), a <emphasis>Server Message
	Block</emphasis> (<acronym>SMB</acronym>) és
      <emphasis>AppSocket</emphasis> (vagy más néven
      <emphasis>JetDirect</emphasis>) protokollokat is ismeri
      valamennyire.  A <application>CUPS</application> a
      hétköznapi igényeknek megfelelõ &unix;
      alapú nyomtatás megteremtéséhez
      ezenkívül még támogatja a
      hálózati nyomtatók
      böngészésének
      lehetõségét, illetve a <emphasis>PostScript
	Printer Description</emphasis> (<acronym>PPD</acronym>,
      PostScript Nyomtató Leírás)
      használatát.  Ennek eredményeképpen a
      <application>CUPS</application> tökéletesen alkalmas
      nyomtatók megosztására és
      elérésére &os;, &linux; &macos;&nbsp;X vagy
      &windows; típusú rendszereket vegyesen
      tartalmazó környezetekben.</para>

    <para>A <application>CUPS</application> hivatalos oldala a <uri xlink:href="http://www.cups.org/">http://www.cups.org/</uri> címen
      érhetõ el.</para>
    </sect1>

    <sect1 xml:id="printing-cups-install">
      <title>A CUPS nyomtatószerver
	telepítése</title>

      <para>A <application>CUPS</application> telepíthetõ
	portként vagy csomagként.  Ha portként
	szeretnénk telepíteni, akkor ahhoz a
	következõ parancsot kell kiadnunk
	rendszergazdaként:</para>

      <screen>&prompt.root; <userinput>cd /usr/ports/print/cups &amp;&amp; make install clean</userinput></screen>

      <para>A <application>CUPS</application> csomagjának
	telepítését pedig ezzel a paranccsal tudjuk
	(szintén rendszergazdaként)
	elvégezni:</para>

      <screen>&prompt.root; <userinput>pkg_add -r cups</userinput></screen>

      <para>További nem kötelezõen
	telepítendõ, de határozottan ajánlott
	csomagok még a <package>print/gutenprint-cups</package> és a
	<package>print/hplip</package>, amelyek
	különbözõ típusú
	nyomtatókhoz tartalmaznak meghajtókat és
	segédprogramokat.  A <application>CUPS</application>
	telepítése után a
	hozzá tartozó konfigurációs
	állományokat a
	<filename>/usr/local/etc/cups</filename> könyvtárban
	találhatjuk.</para>
    </sect1>

    <sect1 xml:id="printing-cups-configuring-server">
      <title>A CUPS nyomtatószerver
	beállítása</title>

      <para>A <application>CUPS</application> szerver
	telepítése után néhány
	állomány módosításával
	végezhetjük el a szükséges
	beállításokat.  Elõször is
	hozzunk létre (ha még nem létezne) vagy
	nyissuk meg az <filename>/etc/devfs.rules</filename>
	állományt és a <systemitem class="groupname">cups</systemitem>
	csoport számára adjunk
	hozzáférést a rendszerünkben
	található összes nyomtatóra:</para>

      <programlisting>[system=10]
add path 'unlpt*' mode 0660 group cups
add path 'ulpt*' mode 0660 group cups
add path 'lpt*' mode 0660 group cups
add path 'usb/<replaceable>X</replaceable>.<replaceable>Y</replaceable>.<replaceable>Z</replaceable>' mode 0660 group cups</programlisting>

      <note>
	<para>Az <replaceable>X</replaceable>,
	  <replaceable>Y</replaceable> és
	  <replaceable>Z</replaceable> helyén a nyomtató
	  <filename>/dev/usb</filename>
	  könyvtárban szereplõ értékeit
	  adjuk meg.  A nyomtatóhoz tartozó
	  eszközleírót a &man.dmesg.8;
	  kimenetében találjuk meg
	  <filename>ugenX.Y</filename>
	  néven, amely egy szimbolikus link a <filename>/dev/usb</filename>
	  könyvtárban található
	  megfelelõjére.</para>
      </note>

      <para>Ezután az <filename>/etc/rc.conf</filename>
	állományba még vegyük fel a
	következõ két sort:</para>

      <programlisting>cupsd_enable="YES"
devfs_system_ruleset="system"</programlisting>

      <para>Az iménti bejegyzések gondoskodnak a
	<application>CUPS</application> nyomtatószerver
	beüzemelésérõl a rendszer
	indítása során, illetve töltik be az
	elõbbi lépésben létrehozott helyi
	devfs szabályokat.</para>

      <para>Bizonyos &microsoft.windows; rendszert
	használó kliensekkel csak akkor fogunk tudni
	nyomtatni a <application>CUPS</application> esetében, ha
	a <filename>/usr/local/etc/cups/mime.types</filename> és
	<filename>/usr/local/etc/cups/mime.convs</filename>
	állományokban kivesszük a
	megjegyzésbõl ezt a sort:</para>

      <programlisting>application/octet-stream</programlisting>

      <para>Miután végrehajtottuk ezeket a
	módosításokat, az alábbi parancsok
	használatával vagy az operációs
	rendszerrel együtt indítsuk újra a
	&man.devfs.8; és <application>CUPS</application>
	szolgáltatásokat:</para>

      <screen>&prompt.root; <userinput>/etc/rc.d/devfs restart</userinput>
&prompt.root; <userinput>/usr/local/etc/rc.d/cupsd restart</userinput></screen>
    </sect1>

    <sect1 xml:id="printing-cups-configuring-printers">
      <title>Nyomtatók beállítása a CUPS
	nyomtatószerveréhez</title>

      <para>A <application>CUPS</application> sikeres
	telepítését és
	beállítását követõen
	elkezdhetjük a nyomtatószerverhez
	kapcsolódó helyi nyomtatók
	hozzáadását.  Ez nagyon hasonló, ha
	nem is teljesen megegyezõ más &unix; alapú
	rendszerek, például &linux; esetén a
	nyomtatók
	beállításához.</para>

      <para>A <application>CUPS</application> szerver
	irányítása és
	mûködtetése elsõsorban az általa
	felkínált webes felületen
	történik, amelyet a <uri xlink:href="http://localhost:631">http://localhost:631</uri> címen keresztül
	tudunk elérni.  Amennyiben a
	<application>CUPS</application> egy másik
	számítógépen fut, akkor a
	címben természetesen a <systemitem>localhost</systemitem>
	(saját gépünk) helyén az adott
	gép <acronym>IP</acronym>-címét kell
	megadnunk.  A <application>CUPS</application> webes
	felületén meglehetõsen könnyen lehet
	tájékozódni, külön menüket
	találunk a nyomtatók és nyomtatási
	sorok beállítására, a
	felhasználók hitelesítésére
	és a többi.  Ezeken felül még az
	<quote>Administration</quote> képernyõ jobb
	oldalán különbözõ
	jelölõnégyzetekkel tudunk egyszerûen
	dönteni a gyakori
	beállításokról,
	például a szerverhez csatlakozó
	nyomtatókat megosztjuk-e a hálózaton
	keresztül, engedünk-e további
	felhasználókat hozzáférni a
	szolgáltatásokhoz, kinek milyen engédelyei
	legyenek a nyomtatókra és nyomtatási
	sorokra.</para>

      <para>A nyomtatók hozzáadásához
	elegendõ a <application>CUPS</application> webes
	felületén az <quote>Administration</quote>
	menün belül az <quote>Add Printer</quote> gombra vagy
	valamelyik <quote>New Printers Found</quote> gombra kattintani.
	A <quote>Device</quote> legördülõ menü
	megjelenése után egyszerûen válasszuk
	ki belõle a megfelelõ helyileg csatlakoztatott
	nyomtatót, majd folytassuk a
	telepítését.  Ha telepítettük a
	korábban ajánlott <package>print/gutenprint-cups</package> és
	<package>print/hplip</package> programokat,
	akkor ennek során a hozzájuk tartozó
	meghajtók is meg fognak jelenni, amelyek esetleg
	többet tudnak vagy megbízhatóbbak.</para>
    </sect1>

    <sect1 xml:id="printing-cups-clients">
      <title>A CUPS kliensek beállítása</title>

      <para>A <application>CUPS</application> szerver
	beállítása, illetve a nyomtatók
	telepítése és megosztása után
	a kliensek, vagyis a <application>CUPS</application>
	által kínált szolgáltatásokat
	elérni kívánó gépek
	beállítása következik.  Ha
	csupán egyetlen gépünk van, amely egyszerre
	szerver és kliens, akkor az itt szereplõ
	információk nagy részére nem lesz
	szükségünk.</para>

      <sect2 xml:id="printing-cups-clients-unix">
	<title>&unix; kliensek</title>

	<para>A &unix; kliensek esetében is a
	  <application>CUPS</application> használatára
	  lesz szükségünk.  Miután rájuk
	  is telepítettük, a <application>CUPS</application>
	  által hálózaton megosztott
	  nyomtatókat maguktól fel is ismerik a
	  különbözõ munkakörnyezetek,
	  például a <application>GNOME</application> vagy
	  <application>KDE</application> nyomtatókezelõi.
	  Emellett a szerverhez hasonlóan a kliensen is el tudjuk
	  érni a <uri xlink:href="http://localhost:631">http://localhost:631</uri>
	  címen a <application>CUPS</application> helyi
	  felhasználói felületét, ahol az
	  <quote>Administration</quote> menüben az <quote>Add
	  Printer</quote> gombbal tudunk felvenni a szervernél
	  tapasztalt módon hasonlóhoz.  Amikor viszont
	  megjelenik a <quote>Device</quote> legördülõ
	  menü, akkor válasszuk az automatikusan felismert
	  hálózati <application>CUPS</application>
	  nyomtatót, vagy az <literal>ipp</literal> és
	  <literal>http</literal> elemek valamelyikén
	  keresztül adjuk meg a hálózati
	  <application>CUPS</application> nyomtató
	  <acronym>IPP</acronym> vagy <acronym>HTTP</acronym>
	  alapú egységes
	  forrásazonosítóját
	  (<acronym>URI</acronym>) a következõ formák
	  valamelyikében:</para>

	<programlisting>ipp://<replaceable>szervernév-vagy-ip</replaceable>/printers/<replaceable>nyomtatónév</replaceable></programlisting>

	<programlisting>http://<replaceable>szervernév-vagy-ip</replaceable>:631/printers/<replaceable>nyomtatónév</replaceable></programlisting>

	<para>Ha a <application>CUPS</application> kliensek
	  valamiért nem látnák a
	  hálózaton megosztott nyomtatókat, akkor
	  próbáljuk meg hozzáadni a
	  <filename>/usr/local/etc/cups/client.conf</filename>
	  állományhoz a következõ sort:</para>

	<programlisting>ServerName <replaceable>szerver-ip</replaceable></programlisting>

	<para>Ahol a <replaceable>szerver-ip</replaceable>
	  helyére írjuk be a hálózatunkon
	  található <application>CUPS</application>
	  szerver helyi
	  <acronym>IP</acronym>-címét.</para>
      </sect2>

      <sect2 xml:id="printing-cups-clients-windows">
	<title>&windows; kliensek</title>

	<para>A &windows; XP elõtti változatai nem
	  képesek együttmûködni a
	  hálózaton megosztott <acronym>IPP</acronym>
	  alapú nyomtatókkal.  A &windowsxp;
	  rendszertõl kezdõdõen azonban már
	  rendelkeznek a szükséges
	  támogatással, ezért itt már nagyon
	  könnyû beállítani a
	  <application>CUPS</application> nyomtatókat.  Ehhez
	  rendszeradminisztrátorként futtassuk a &windows;
	  a nyomtatók hozzáadásához
	  tartozó varázslóját, ahol
	  válasszuk a <quote>Hálózati
	  nyomtató</quote> típust, majd a
	  következõ formában töltsük ki az
	  eszköz
	  forrásazonosítóját:</para>

	<programlisting>http://<replaceable>szervernév-vagy-ip</replaceable>:631/printers/<replaceable>nyomtatónév</replaceable></programlisting>

	<para>Ha az <acronym>IPP</acronym>
	  támogatását még nem
	  tartalmazó régebbi &windows; változatunk
	  van, akkor a <application>CUPS</application>
	  szolgáltatásait a <package>net/samba3</package> szerveren keresztül
	  tudjuk elérhetõvé tenni, azonban ennek
	  bemutatásával itt most nem foglalkozunk.</para>
      </sect2>
    </sect1>

    <sect1 xml:id="printing-cups-troubleshooting">
      <title>Hibakeresés</title>

      <para>A <application>CUPS</application> használata
	során tapasztalható problémák
	többségét az engedélyek helytelen
	beállítása okozza.  Elõször
	tehát, ha valami nem mûködik rendesen, akkor
	ellenõrizzük újra az elõbb
	felvázolt &man.devfs.8;
	beállításokat.  Ezután
	gyõzõdjünk meg arról is, hogy az
	állományrendszerben ténylegesen
	keletkezõ eszközök engedélyei
	megfelelõek.  Továbbá segíthet
	megoldani a problémát, ha felvesszük a
	felhasználónkat a korábban tárgyalt
	<systemitem class="groupname">cups</systemitem> csoportba.  Ha a
	<application>CUPS</application> felhasználói
	felületének <quote>Administration</quote>
	képernyõjén található
	beállítások látszólag
	hatástalanok, akkor érdemes úgy
	próbálkoznunk, hogy elõször
	készítünk egy bizonsági
	másolatot a
	<filename>/usr/local/etc/cups/cupsd.conf</filename>
	állományról és kézzel
	módosítgatva kísérletezünk
	különféle konfigurációs
	lehetõségek kombinációival.  Ehhez
	találhatunk itt egy példát.  Ezzel
	kapcsolatban azonban megjegyezzük, hogy a bemutatott
	<filename>cupsd.conf</filename> állomány
	inkább áttekinthetõ mintsem
	biztonságos módon tárgyalja a
	lehetõségeket.  Ezért javasoljuk, hogy
	miután sikerült elérnünk a
	<application>CUPS</application> szervert és
	beállítani a klienseket, nézzük
	át alaposan a mintául szolgáló
	opciókat és korlátozzuk le minél
	jobban a hozzáférést.</para>

      <programlisting>
# Általános információk naplózása.  Ha hibát keresünk, írjuk az
# "info" helyett a "debug" értéket.
LogLevel info

# A rendszergazdák csoportja.
SystemGroup wheel

# A 631-es porton várjuk a kliensek kapcsolódását.
Port 631
#Listen localhost:631
Listen /var/run/cups.sock

# A helyi hálózaton megosztott nyomtatók mutatása.
Browsing On
BrowseOrder allow,deny
#BrowseAllow @LOCAL
BrowseAllow 192.168.1.*   # Adjuk meg a helyi hálózatunkat.
BrowseAddress 192.168.1.* # Adjuk meg a helyi hálózatunkat.

# Alapértelmezett hitelesítési módszer, amikor szükség van rá.
DefaultAuthType Basic
DefaultEncryption Never # Vegyük ki ezt a sort, ha titkosítani akarunk.

# A szervert a helyi hálózaton bármelyik gép elérheti.
&lt;Location /&gt;
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # Adjuk meg a helyi hálózatunkat.
&lt;/Location&gt;

# A helyi hálózatról el tudjuk érni az adminisztrációs felületet.
&lt;Location /admin&gt;
  #Encryption Required
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # Adjuk meg a helyi hálózatunkat.
&lt;/Location&gt;

# A helyi hálózatunkról el tudjuk érni a konfigurációs állományt.
&lt;Location /admin/conf&gt;
  AuthType Basic
  Require user @SYSTEM
  Order allow,deny
  #Allow localhost
  Allow 192.168.1.* # Adjuk meg a helyi hálózatunkat.
&lt;/Location&gt;

# Az alapértelmezett nyomtatási és feladatkezelési házirendek.
&lt;Policy default&gt;
  # A feladatokat kizárólag csak a tulajdonosaik vagy a rendszergazda
  # képesek elvégezni.
  &lt;Limit Send-Document Send-URI Hold-Job Release-Job Restart-Job Purge-Jobs \
Set-Job-Attributes Create-Job-Subscription Renew-Subscription Cancel-Subscription \
Get-Notifications Reprocess-Job Cancel-Current-Job Suspend-Current-Job Resume-Job \
CUPS-Move-Job&gt;
    Require user @OWNER @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  # A karbantartást csak megfelelõ hitelesítés után végezhetünk.
  &lt;Limit Pause-Printer Resume-Printer Set-Printer-Attributes Enable-Printer \
Disable-Printer Pause-Printer-After-Current-Job Hold-New-Jobs Release-Held-New-Jobs \
Deactivate-Printer Activate-Printer Restart-Printer Shutdown-Printer Startup-Printer \
Promote-Job Schedule-Job-After CUPS-Add-Printer CUPS-Delete-Printer CUPS-Add-Class \
CUPS-Delete-Class CUPS-Accept-Jobs CUPS-Reject-Jobs CUPS-Set-Default&gt;
    AuthType Basic
    Require user @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  # A feladatokat csak a tulajdonosaik és a rendszergazda tudják törölni.
  &lt;Limit Cancel-Job CUPS-Authenticate-Job&gt;
    Require user @OWNER @SYSTEM
    Order deny,allow
  &lt;/Limit&gt;

  &lt;Limit All&gt;
    Order deny,allow
  &lt;/Limit&gt;
&lt;/Policy&gt;</programlisting>
    </sect1>

    <sect1 xml:id="printing-cups-ports-knobs">
      <title>A CUPS portok finomhangolása</title>

      <para>Ha a <application>CUPS</application> lesz az
	elsõdlegesen használt nyomtatási rendszer,
	akkor az <filename>/etc/make.conf</filename>
	állományban érdemes lehet még
	további olyan változókat
	beállítanunk, amelyek elõtérbe
	helyezik a <application>CUPS</application>
	használatát a többi nyomtatási
	lehetõséggel szemben.  Ezek közül most
	szót ejtünk néhányról:</para>

      <programlisting>WITH_CUPS=YES
CUPS_OVERWRITE_BASE=YES
WITHOUT_LPR=YES</programlisting>

      <para>Elsõként a <varname>WITH_CUPS</varname>
	látható, amely hatására a portok
	telepítésük során
	lehetõség szerint a <application>CUPS</application>
	megoldásaira fognak építkezni.
	Másodikként a
	<varname>CUPS_OVERWRITE_BASE</varname> szerepel, amely
	megadásával a telepítés során
	a &os; alapértelmezett nyomtatási rendszere, az
	<application>LPR</application> szimbolikus linkjei és
	állományai cserélõdnek le, illetve
	megakadályozza, hogy ez visszaforduljon a rendszer egy
	késõbbi frissítésekor.  A harmadik, a
	<varname>WITHOUT_LPR</varname> az <application>LPR</application>
	használatának mellõzésére
	utasítja az érintett portokat.</para>
  </sect1>

  <index/>
</article>
